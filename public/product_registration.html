<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Product Registration - REEV</title>
    <!-- Include Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gray-50">
    <div class="min-h-screen p-4">
        <div class="max-w-3xl mx-auto">
            <!-- Header with Back Navigation -->
            <div class="flex items-center mb-6">
                <button onclick="history.back()" class="p-2 hover:bg-gray-100 rounded-full">
                    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                        <path d="M19 12H5m7 7-7-7 7-7"/>
                    </svg>
                </button>
                <h1 class="text-2xl font-bold ml-2">Product Registration</h1>
            </div>

            <!-- Main Registration Form -->
            <div class="bg-white rounded-lg shadow p-6">
                <form id="productForm" class="space-y-6" enctype="multipart/form-data">
                    <!-- Company Details Section -->
                    <div class="space-y-4">
                        <!-- Company Name Input -->
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-1">
                                Company Name
                            </label>
                            <input
                                type="text"
                                name="companyName"
                                required
                                class="w-full p-2 border rounded-md"
                            >
                        </div>

                        <!-- Product Name Input -->
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-1">
                                Product Name
                            </label>
                            <input
                                type="text"
                                name="productName"
                                required
                                class="w-full p-2 border rounded-md"
                            >
                        </div>

                        <!-- Category Selection -->
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-1">
                                Category
                            </label>
                            <select
                                name="category"
                                required
                                class="w-full p-2 border rounded-md"
                            >
                                <option value="">Select category</option>
                                <option value="electronics">Electronics</option>
                                <option value="fashion">Fashion</option>
                                <option value="food">Food & Beverages</option>
                                <option value="health">Health & Beauty</option>
                                <option value="other">Other</option>
                            </select>
                        </div>

                        <!-- Product Description -->
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-1">
                                Description
                            </label>
                            <textarea
                                name="description"
                                rows="3"
                                class="w-full p-2 border rounded-md"
                            ></textarea>
                        </div>

                        <!-- Manufacturing Details Grid -->
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                            <!-- Manufacturing Date -->
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-1">
                                    Manufacturing Date
                                </label>
                                <input
                                    type="date"
                                    name="manufacturingDate"
                                    required
                                    class="w-full p-2 border rounded-md"
                                >
                            </div>
                            <!-- Expiry Date -->
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-1">
                                    Expiry Date
                                </label>
                                <input
                                    type="date"
                                    name="expiryDate"
                                    class="w-full p-2 border rounded-md"
                                >
                            </div>
                        </div>

                        <!-- Product Identification Grid -->
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                            <!-- Batch Number -->
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-1">
                                    Batch Number
                                </label>
                                <input
                                    type="text"
                                    name="batchNumber"
                                    required
                                    class="w-full p-2 border rounded-md"
                                >
                            </div>
                            <!-- Serial Number -->
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-1">
                                    Serial Number
                                </label>
                                <input
                                    type="text"
                                    name="serialNumber"
                                    required
                                    class="w-full p-2 border rounded-md"
                                >
                            </div>
                        </div>

                        <!-- Price Input -->
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-1">
                                Price
                            </label>
                            <input
                                type="number"
                                name="price"
                                required
                                min="0"
                                step="0.01"
                                class="w-full p-2 border rounded-md"
                            >
                        </div>

                        <!-- Image Upload Section -->
                        <div class="mt-4">
                            <label class="block text-sm font-medium text-gray-700 mb-2">
                                Product Image
                            </label>
                            <div class="flex justify-center items-center w-full">
                                <label class="flex flex-col justify-center items-center w-full h-64 bg-gray-50 rounded-lg border-2 border-gray-300 border-dashed cursor-pointer hover:bg-gray-100">
                                    <!-- Image Preview Container -->
                                    <div id="preview-container" class="hidden w-full h-full">
                                        <img id="preview" class="w-full h-full object-contain p-2" />
                                    </div>
                                    <!-- Upload Icon and Text -->
                                    <div id="upload-icon" class="flex flex-col justify-center items-center pt-5 pb-6">
                                        <svg class="w-12 h-12 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v16m8-8H4"/>
                                        </svg>
                                        <p class="mb-2 text-sm text-gray-500">
                                            <span class="font-semibold">Click to upload</span> or drag and drop
                                        </p>
                                        <p class="text-xs text-gray-500">PNG, JPG up to 5MB</p>
                                    </div>
                                    <!-- Hidden File Input -->
                                    <input 
                                        type="file" 
                                        id="fileInput"
                                        name="image"
                                        class="hidden" 
                                        accept="image/*"
                                    >
                                </label>
                            </div>
                        </div>
                    </div>

                    <!-- Submit Button -->
                    <button
                        type="submit"
                        class="w-full bg-blue-600 text-white py-2 px-4 rounded-md hover:bg-blue-700"
                    >
                        Register Product
                    </button>
                </form>
            </div>
        </div>
    </div>

    <!-- Form Handling Script -->
    <script>
        // Image preview functionality
        const fileInput = document.getElementById('fileInput');
        const preview = document.getElementById('preview');
        const previewContainer = document.getElementById('preview-container');
        const uploadIcon = document.getElementById('upload-icon');

        // Handle file selection for preview
        fileInput.addEventListener('change', function(e) {
            const file = e.target.files[0];
            if (file) {
                const reader = new FileReader();
                reader.onload = function(e) {
                    preview.src = e.target.result;
                    previewContainer.classList.remove('hidden');
                    uploadIcon.classList.add('hidden');
                }
                reader.readAsDataURL(file);
            }
        });

        // Enhanced form submission handler with better error handling
        document.getElementById('productForm').addEventListener('submit', async function(e) {
            e.preventDefault();
            
            try {
                const formData = new FormData(this);
                
                // Send the request
                const response = await fetch('/api/products', {
                    method: 'POST',
                    body: formData
                });
                
                // First check if the response is JSON
                const contentType = response.headers.get('content-type');
                if (!contentType || !contentType.includes('application/json')) {
                    throw new Error('Server returned invalid response format');
                }

                const result = await response.json();
                
                if (!response.ok) {
                    throw new Error(result.error || 'Failed to register product');
                }
                
                // Success case
                console.log('Product registered:', result);
                alert('Product registered successfully!\nQR Code ID: ' + result.qrId);
                
                // Reset form and image preview
                this.reset();
                previewContainer.classList.add('hidden');
                uploadIcon.classList.remove('hidden');
                
            } catch (error) {
                console.error('Error:', error);
                alert('Failed to register product: ' + (error.message || 'Unknown error occurred'));
            }
        });
    </script>
</body>
</html> 